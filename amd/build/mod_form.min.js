define("mod_googlemeet/mod_form",["core/notification","core/str","mod_googlemeet/gapi"],(function(notification,str,gapi){return{init:function(clientId,apiKey,userTimeZone){let tokenClient,gapiInited=!1,gisInited=!1;var discoveryDocs=["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],requiredfield="",strcheckweekdays="",invalideventendtime="",invalideventenddate="",timeahead="";str.get_strings([{key:"requirednamefield",component:"mod_googlemeet"},{key:"checkweekdays",component:"mod_googlemeet"},{key:"invalideventendtime",component:"mod_googlemeet"},{key:"invalideventenddate",component:"mod_googlemeet"},{key:"timeahead",component:"mod_googlemeet"}]).done((function(strs){requiredfield=strs[0],strcheckweekdays=strs[1],invalideventendtime=strs[2],invalideventenddate=strs[3],timeahead=strs[4]})).fail(notification.exception);var generateUrlRoomButton=document.getElementById("id_generateurlroom"),urlFieldHidden=document.getElementById("id_url"),urlViewerField=document.getElementById("id_url_viewer"),originalNameFieldHidden=document.getElementById("id_originalname"),creatorEmailFieldHidden=document.getElementById("id_creatoremail"),form=document.querySelector("#region-main .mform");function getDateString(name,format){var formData=new FormData(form),year=formData.get(name+"[year]"),month=formData.get(name+"[month]"),day=formData.get(name+"[day]");return month=("0"+month).slice(-2),day=("0"+day).slice(-2),format?year+"-"+month+"-"+day:year+month+day}function validate(){var formData=new FormData(form),nameInput=document.getElementById("id_name"),nameError=document.getElementById("id_error_name");if(0===formData.get("name").trim().length)return nameInput.classList.add("is-invalid"),nameInput.focus(),nameError.innerText="- "+requiredfield,nameError.style.display="block",!1;nameInput.classList.remove("is-invalid"),nameError.innerText="",nameError.style.display="none";var eventTimeError=document.getElementById("id_googlemeet_eventtime_error"),starttime=3600*formData.get("starthour")+60*formData.get("startminute");if(3600*formData.get("endhour")+60*formData.get("endminute")<starttime)return eventTimeError.innerText=invalideventendtime,eventTimeError.style.display="block",document.getElementById("id_endhour").focus(),!1;eventTimeError.innerText="",eventTimeError.style.display="none";var eventdate=Math.floor(new Date(getDateString("eventdate",!0)).getTime()/1e3),eventenddate=Math.floor(new Date(getDateString("eventenddate",!0)).getTime()/1e3),eventenddateerror=document.getElementById("id_googlemeet_eventenddategroup_error");if(formData.get("addmultiply")&&0!==eventdate&&0!==eventenddate&&eventenddate<eventdate)return eventenddateerror.innerText=invalideventenddate,eventenddateerror.style.display="block",document.getElementById("id_eventenddate_day").focus(),!1;if(formData.get("addmultiply")&&Math.ceil((eventenddate-eventdate)/31536e3)>1)return eventenddateerror.innerText=timeahead,eventenddateerror.style.display="block",document.getElementById("id_eventenddate_day").focus(),!1;if(eventenddateerror.innerText="",eventenddateerror.style.display="none",formData.get("addmultiply")){var dayserror=document.getElementById("id_googlemeet_days_error");if(!function(){for(var formData=new FormData(form),starthour=formData.get("starthour"),startminute=formData.get("startminute"),endhour=formData.get("endhour"),endminute=formData.get("endminute"),starttime=(starthour=("0"+starthour).slice(-2))+":"+(startminute=("0"+startminute).slice(-2))+":00",endtime=(endhour=("0"+endhour).slice(-2))+":"+(endminute=("0"+endminute).slice(-2))+":00",eventdate=getDateString("eventdate",!0)+" "+starttime,eventenddate=getDateString("eventenddate",!0)+" "+endtime,daysofweek=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],start=new Date(eventdate),end=new Date(eventenddate),found=!1;start<=end;){if(!found)for(var i=0;i<=daysofweek.length;i++){var currentday=daysofweek[start.getDay()];if(formData.get("days["+daysofweek[i]+"]")&&currentday===daysofweek[i]){found=!0;break}}start=new Date(start.setDate(start.getDate()+1))}return found}())return dayserror.innerText=strcheckweekdays,dayserror.style.display="block",document.getElementById("id_days_Mon").focus(),!1;dayserror.innerText="",dayserror.style.display="none"}return!0}async function initializeGapiClient(){await gapi.client.init({apiKey:apiKey,discoveryDocs:discoveryDocs}),gapiInited=!0,maybeEnableButtons()}function maybeEnableButtons(){if(gapiInited&&gisInited)return generateUrlRoomButton.onclick=handleAuthClick,void(generateUrlRoomButton.disabled=!1)}function handleAuthClick(){tokenClient.callback=async resp=>{if(void 0!==resp.error)throw resp;!function(){if(function(){var pre=document.getElementById("googlemeetcontentlog");pre.style.display="none",pre.innerHTML=""}(),!validate())return;!function(){var formData=new FormData(form),starthour=formData.get("starthour"),startminute=formData.get("startminute"),endhour=formData.get("endhour"),endminute=formData.get("endminute");starthour=("0"+starthour).slice(-2),startminute=("0"+startminute).slice(-2),endhour=("0"+endhour).slice(-2),endminute=("0"+endminute).slice(-2);var eventstarttime=starthour+":"+startminute+":00",eventendtime=endhour+":"+endminute+":00",start={dateTime:getDateString("eventdate",!0)+"T"+eventstarttime,timeZone:userTimeZone},end={dateTime:getDateString("eventdate",!0)+"T"+eventendtime,timeZone:userTimeZone},recurrence=[];if(formData.get("addmultiply")){var interval="INTERVAL="+formData.get("period"),until="UNTIL="+getDateString("eventenddate",!1)+"T235959Z",byday="BYDAY=",daysofweek={Sun:"SU",Mon:"MO",Tue:"TU",Wed:"WE",Thu:"TH",Fri:"FR",Sat:"SA"};for(var day in daysofweek)formData.get("days["+day+"]")&&(byday+=daysofweek[day]+",");recurrence=["RRULE:FREQ=WEEKLY;"+interval+";"+until+";"+byday]}var name=function(name){var random=Math.floor(8888*Math.random())+1111;return name+" ("+random+")"}(formData.get("name")),eventResource={summary:name,description:formData.get("introeditor[text]"),start:start,end:end,recurrence:recurrence};showLoading(!0),gapi.client.calendar.events.insert({calendarId:"primary",resource:eventResource}).then((function(response){var event=response.result,eventPatch={conferenceData:{createRequest:{requestId:event.id}}};gapi.client.calendar.events.patch({calendarId:"primary",eventId:event.id,resource:eventPatch,sendNotifications:!1,conferenceDataVersion:1}).then((function(response){var event=response.result;generateUrlRoomButton.remove(),originalNameFieldHidden.value=name,urlFieldHidden.value=event.hangoutLink,urlViewerField.value=event.hangoutLink,creatorEmailFieldHidden.value=event.creator.email,document.getElementById("id_googlemeet_generateurlgroup_error").style.display="none",showLoading(!1)})).catch((function(error){appendPre(JSON.stringify(error.result.error,null,2)),showLoading(!1)}))})).catch((function(error){appendPre(JSON.stringify(error.result.error,null,2)),showLoading(!1)}))}()}()},null===gapi.client.getToken()?tokenClient.requestAccessToken({prompt:"consent"}):tokenClient.requestAccessToken({prompt:""})}function showLoading(show){var generateurlroomLoading=document.getElementById("generateurlroomLoading");show?(generateurlroomLoading.style.display="block",generateUrlRoomButton.disabled=!0):(generateurlroomLoading.style.display="none",generateUrlRoomButton.disabled=!1)}function appendPre(message){var pre=document.getElementById("googlemeetcontentlog"),textContent=document.createTextNode(message+"\n");pre.style.display="block",pre.appendChild(textContent)}gapi.load("client",initializeGapiClient),tokenClient=google.accounts.oauth2.initTokenClient({client_id:clientId,scope:"https://www.googleapis.com/auth/calendar.events",callback:""}),gisInited=!0,maybeEnableButtons()}}}));

//# sourceMappingURL=mod_form.min.js.map